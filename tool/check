#!/usr/bin/env bash
set -euo pipefail

ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
FLUTTERW="$ROOT/tool/flutterw"

run_flutter_pkg() {
  local rel_dir="$1"
  shift

  echo "==> $rel_dir"
  cd "$ROOT/$rel_dir"

  if [[ ! -f ".dart_tool/package_config.json" ]]; then
    "$FLUTTERW" pub get --offline
  fi

  "$FLUTTERW" analyze
  "$FLUTTERW" test --no-pub "$@"
}

run_flutter_pkg app "$@"
run_flutter_pkg packages/data

